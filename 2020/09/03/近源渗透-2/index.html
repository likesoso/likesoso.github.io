<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        likesoso - 随便写写
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            近源渗透(2)
        </p>
        <hr>
    </div>
    <div class="post-content">
        <hr>
<h1 id="扫描与发现无线网络"><a href="#扫描与发现无线网络" class="headerlink" title="扫描与发现无线网络"></a>扫描与发现无线网络</h1><p><strong>被动扫描</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;客户端在每个信道上切换以监听AP周期性（100ms）发送的beacon帧，获得接入点的SSID（热点名称）、BSSID（AP的MAC地址）、所支持的速率。</p>
<p><strong>主动扫描</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;客户端在每个信道之间切换，并向广播地址（ff:ff:ff:ff:ff:ff）发送Probe Requests帧，一旦发送后就会启动一个计时器并等待响应，计时器结束后处理所有收到的应答。没有响应的话就切换至下一个信道重复以上过程。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;定向探测请求：发送的Probe Requests帧指定SSID，只有该SSID会应答；</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;广播探测请求：发送的Probe Requests帧SSID的值为空，收到请求的所有热点都会响应。</p>
<p><strong>监听模式</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;非监听模式下，系统内核会将筛选后的802.11帧封装成普通的网络帧传递给上层；</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;监听模式下，内核会直接将802.11帧直接传递给上层，在用户层直接通过接口就可得到原始数据包。</p>
<blockquote>
<p>Linux系统中的NetworkManager等网络配置会改变网卡的工作模式和对信道造成干扰，使用一下命令：<strong>airmon-ng check kill</strong>停止此类服务。通过sudo service –status-all、service network-manager restar开启。</p>
</blockquote>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>_iwfonfig_<strong>命令</strong></p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-1.png" alt="2-1.png"></p>
<p>将wlan0设置为监听模式并设置信道为11</p>
<p><code>ifconfig wlan0 down</code><br><code>iwconfig wlan0 mode monitor</code><br><code>ifconfig wlan0 up</code><br><code>iwconfig wlan0 channel 11</code></p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-2.png" alt="2-2.png"></p>
<p>iw<strong>命令</strong></p>
<p>iw命令是iwconfig的扩展,可以查看无线网卡接口名称、工作模式、信道等信息</p>
<p><code>iw dev wlan0 info</code></p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-3.png" alt="2-3.png"></p>
<p>除此之外，iw命令还可以开启虚拟接口：</p>
<p><code>iw dev wlan0 interface add mon0 type monitor</code><br><code>ifconfig mon0 up</code><br><code>iw dev mon0 set channel 11</code></p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-4.png" alt="2-4.png"></p>
<p>撤销命令<br><code>iw dev mon0 del</code></p>
<h2 id="常用组件"><a href="#常用组件" class="headerlink" title="常用组件"></a>常用组件</h2><p><strong>Airmon-ng（小写的airmon-ng是Airmon-ng工具中的一个组件）是一款常用的渗透测试及破解类工具之一，他包含了多款无线审计工具</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">aircrake-ng：主要用于WEP、WAP-PSK的密码恢复，只要airodump-ng收集到足够数量的数据包，aircarke-ng就可以检测是否可破解</span><br><span class="line"></span><br><span class="line">airmon-ng：改变无线网卡的工作模式</span><br><span class="line"></span><br><span class="line">airodump-ng：捕获802.11数据报文，便于aircarck-ng破解</span><br><span class="line"></span><br><span class="line">aireplay-ng：在进行WEP、WAP-PSK密码恢复时，可以根据需要创建特殊的无线网络报文及流量</span><br><span class="line"></span><br><span class="line">airsev-ng：将无线网卡连接至某一特定端口，为攻击时灵活调用做准备</span><br><span class="line"></span><br><span class="line">airolib-ng：进行WPA Rainbow Table时，建立特定的数据库文件</span><br><span class="line"></span><br><span class="line">airdecap-ng：解开加密数据包</span><br><span class="line"></span><br><span class="line">wesside-ng：自动化破解WEP的工具</span><br></pre></td></tr></table></figure>

<h2 id="扫描无线网络"><a href="#扫描无线网络" class="headerlink" title="扫描无线网络"></a>扫描无线网络</h2><h3 id="airmon-ng"><a href="#airmon-ng" class="headerlink" title="airmon-ng"></a>airmon-ng</h3><p>使用airmon-ng start wlan0 开启监听模式</p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-5.png" alt="2-5.png"></p>
<p><strong>airodump-ng wlan0mon 抓包</strong></p>
<p><img src="/2020/09/03/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F-2/2-6.png" alt="2-6.png"></p>
<p>其中包括两部分内容：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<strong>上半部分：周边的热点信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_BSSID_（MAC地址）</span><br><span class="line">_PWR_（信号强度）</span><br><span class="line">_Beacons_（信标帧数量）</span><br><span class="line">_Data_（数据分组数量）</span><br><span class="line">_CH_（信道）</span><br><span class="line">_ENC_（加密算法）</span><br><span class="line">_CIPHER_（认证协议）</span><br><span class="line">_ESSID_（热点名称）</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;<strong>下半部分：捕获到的无线客户端</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_STATION_（已连接热点客户端MAC地址）</span><br></pre></td></tr></table></figure>

<h3 id="KISmet"><a href="#KISmet" class="headerlink" title="KISmet"></a>KISmet</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;Kismet是一款802.11协议数据包捕获分析框架，额外支持无线帧的嗅探和破解、隐藏热点的发现 以及GPS和蓝牙扫描</p>
<h3 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;过滤规则：</p>
<p>筛选所有Beacon帧：<code>wlan.fctype_subtype == 0x0008</code></p>
<p>筛选所有Probe Response帧：<code>wlan.fctype_subtype == 0x0005</code></p>
<h2 id="对于隐藏网络的发现"><a href="#对于隐藏网络的发现" class="headerlink" title="对于隐藏网络的发现"></a>对于隐藏网络的发现</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;出于安全考虑，许多的无线网络都会开启隐藏模式。在此模式下Beacon帧中将不包含SSID，也不在回复Broadcast Probe REquests帧。<strong>合法的客户端想要连接，需要发送包含了热点名称的Directed Probe Requests帧。</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;简单来说就是：必须知道热点的名称，才可以与隐藏模式下的热点建立连接</p>
<p><strong>薄弱点</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;合法的客户端想要连接，需要发送包含了热点名称的Directed Probe Requests帧</p>
<p> <strong>利用方式</strong></p>
<p> 1.抓包，等待合法用户连接</p>
<p> 2.将合法用户从连接中“踢掉”，迫使他重新连接发起交互，抓包（deauth攻击）</p>
<p><strong>总结</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;隐藏热点并不能增加安全性，攻击者只是多个一个步骤而已。</p>

    </div>

    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/sanjinhub/hexo-theme-geek">Geek</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="CmCti21ooOOIzFOhEyFkFvR0-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="FqiyUqbg7McKN2eG0MCewupf">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>